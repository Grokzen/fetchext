# Plan: Plugin System v2

## Objective

Enhance the existing plugin system to provide more context to hooks and allow them to modify behavior.

## Current State

- Plugins are simple Python scripts in `~/.config/fext/hooks`.
- Hooks are triggered at specific points (e.g., `post_download`).
- Context passed to hooks is limited.

## Proposed Changes

1. **Enhanced Context**: Pass a `Context` object to hooks containing:
    - `config`: The full configuration dictionary.
    - `args`: The parsed CLI arguments.
    - `metadata`: Extension metadata (if available).
    - `paths`: Relevant file paths (download path, extract path).
2. **Modifiable Behavior**: Allow hooks to return values that influence the flow (e.g., cancel download, modify paths).
3. **New Hooks**: Add more hook points:
    - `pre_download`: Before download starts (can cancel).
    - `post_extract`: After extraction.
    - `pre_analysis`: Before analysis starts.
    - `post_analysis`: After analysis completes.

## Implementation Details

- Modify `src/fetchext/plugins.py` to define the `Context` class and update `PluginManager`.
- Update `src/fetchext/core.py` and `src/fetchext/cli.py` to pass the enhanced context when calling hooks.
- Define a standard interface for hooks (e.g., `def hook(context: Context) -> Optional[Result]:`).

## Verification

- Create a test plugin that uses the new context.
- Verify that the plugin receives the correct data.
- Verify that the plugin can modify the flow (e.g., cancel a download).
