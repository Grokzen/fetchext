# Plan: Complexity Analysis (v1.1.0)

## Goal

Implement a complexity analysis tool to calculate cyclomatic complexity of JavaScript files within an extension. This helps identify obfuscated code or poorly maintained sections.

## Tools

- **Lizard**: A cyclomatic complexity analyzer that supports JavaScript.

## Strategy

### 1. New Command

- `fext analyze <file> --complexity`
- Or maybe `fext analyze complexity <file>`?
- The roadmap says `fext analyze --complexity <file>`.
- I'll implement `fext analyze` as a new subcommand group, with `complexity` as an option or subcommand.
- Let's make `analyze` a subcommand, and `complexity` a sub-subcommand or flag.
- `fext analyze <file> --complexity` implies `analyze` takes a file and flags determine what to analyze.
- But `fext analyze --domains` is also planned.
- So `fext analyze <file>` could run all enabled analyses, or specific ones.
- Let's go with `fext analyze <file> [--complexity] [--entropy] [--domains]`.

### 2. Implementation

- Add `lizard` to `requirements.txt` (it's a runtime dependency for this feature).
- Create `src/fetchext/analysis/complexity.py`.
- Use `PartialFileReader` to extract JS files to memory (or temp dir) and feed them to `lizard`.
- `lizard` works on files or strings.
- Report:
  - Average complexity.
  - Max complexity.
  - List of functions with high complexity (> 15).

### 3. Integration

- Update `cli.py` to add `analyze` command.
- Update `README.md` and docs.

## Steps

1. Add `lizard` to `pyproject.toml` and `requirements-dev.txt`.
2. Create `src/fetchext/analysis/` package.
3. Implement `complexity.py`.
4. Update `cli.py`.
5. Add tests.
