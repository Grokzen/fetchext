# Plan: Local Server (v1.4.0)

## Goal

Implement `fext serve` to host the local repository as a Chrome Update Server (HTTP). This allows browsers to update extensions directly from this local server.

## Requirements

1. **New Command**: `fext serve`
2. **Arguments**:
    - `--port`: Port to listen on (default: 8000).
    - `--host`: Host to bind to (default: 127.0.0.1).
    - `--directory`: Directory to serve (default: current directory).
3. **Functionality**:
    - Start a simple HTTP server (using `http.server` or `aiohttp`).
    - Serve static files (CRX/XPI).
    - Serve `update.xml` / `updates.json` (generated on the fly or pre-generated).
    - Log requests to console.
4. **Integration**:
    - Reuse `server.py` (which currently has `generate_update_manifest`).
    - Add `serve` function to `server.py`.
    - Update `cli.py`.

## Implementation Steps

1. **Update `src/fetchext/server.py`**:
    - Add `run_server(directory, host, port)` function.
    - Use `http.server.SimpleHTTPRequestHandler` subclass to handle requests.
    - Ideally, it should check if `update.xml` exists. If not, maybe generate it in memory? For now, let's assume the user has run `fext update-manifest` or we can just serve the directory as static files.
    - Actually, `SimpleHTTPRequestHandler` is enough for serving static files.
2. **Update `src/fetchext/cli.py`**:
    - Add `serve` subcommand.
    - Call `server.run_server`.
3. **Tests**:
    - Unit test for `run_server` (mocking `http.server`).
    - Integration test: Start server in thread, make request, stop server.

## Verification

- Run `fext serve`.
- Access `http://localhost:8000/update.xml` (if it exists).
- Access `http://localhost:8000/extension.crx`.
