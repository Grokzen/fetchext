# Plan: Unified Exception Handling (v1.5.0 Item 2)

## Goal

Implement a consistent exception hierarchy to improve error reporting and handling. Replace generic exceptions with domain-specific ones.

## Current State

- Code raises `ValueError`, `FileNotFoundError`, `RuntimeError`, etc.
- `cli.py` catches `Exception` and prints a generic error message (or stack trace if verbose).

## Proposed Hierarchy

Create `src/fetchext/exceptions.py`:

```python
class FetchextError(Exception):
    """Base class for all fetchext exceptions."""
    def __init__(self, message, original_exception=None):
        super().__init__(message)
        self.original_exception = original_exception

class NetworkError(FetchextError):
    """Network-related errors (download failed, 404, timeout)."""
    pass

class ConfigError(FetchextError):
    """Configuration errors (missing file, invalid key)."""
    pass

class ExtensionError(FetchextError):
    """Extension parsing or validation errors."""
    pass

class SecurityError(FetchextError):
    """Security violations (signature mismatch, risk threshold)."""
    pass
```

## Implementation Steps

1. **Create Module**: `src/fetchext/exceptions.py`. [x]
2. **Refactor Core**:
    - Update `src/fetchext/core.py` to catch low-level exceptions and raise `FetchextError` subclasses. [x]
    - Update `src/fetchext/downloaders/*.py` to raise `NetworkError`. [x]
    - Update `src/fetchext/config.py` to raise `ConfigError`. [x]
    - Update `src/fetchext/crx.py` and `inspector.py` to raise `ExtensionError`. [x]
3. **Refactor CLI**:
    - Update `src/fetchext/cli.py` to catch `FetchextError` specifically. [x]
    - Print clean error messages for `FetchextError` (without stack trace unless `-v`). [x]
    - Keep generic `Exception` catch for unexpected bugs (with stack trace). [x]

## Verification

1. **Unit Tests**: Add tests for exception hierarchy. [x]
2. **Integration Tests**: Verify that CLI prints clean errors for known failure modes (e.g., 404, invalid file). [x]
