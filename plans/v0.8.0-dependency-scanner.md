# Plan: Dependency Scanner (v0.8.0)

## Goal

Implement a `scan` command to analyze extension source code for known third-party libraries and potential vulnerabilities. This helps auditors identify outdated or insecure dependencies embedded in extensions.

## Requirements

1. **Command**: `fext scan <file> [--json]`
    * `file`: Path to `.crx` or `.xpi`.
    * `--json`: Output as JSON.
2. **Logic**:
    * Open the extension archive (streaming/random access).
    * Iterate through all files.
    * Identify JavaScript files.
    * **Detection Strategy**:
        * **Filename Matching**: `jquery-3.0.0.js`, `react.production.min.js`.
        * **Content Heuristics**: Read first few lines for version comments (e.g., `/*! jQuery v1.12.4 ... */`).
        * **Hash Matching**: Compare file hash against a known database of vulnerable library versions (optional/extensible).
    * **Reporting**:
        * List detected libraries and versions.
        * Flag "Vulnerable" if version is known to be bad (e.g., jQuery < 3.5.0).

## Implementation Details

### 1. New Module: `src/fetchext/scanner.py`

* Class `DependencyScanner`
  * `scan(file_path) -> ScanReport`
  * `_detect_library(filename, content_stream)`
  * `_check_vulnerability(library, version)`

### 2. Signatures

* Hardcode a small set of common signatures for MVP:
  * jQuery (regex for version in header).
  * React.
  * Angular.
  * Vue.
  * Lodash.
  * Moment.js.

### 3. CLI Integration

* Add `scan` subcommand.

## Testing Strategy

1. **Unit**: Test detection logic with dummy JS files containing library headers.
2. **Integration**: Scan a real extension (mocked).

## Tasks

* [ ] Create `src/fetchext/scanner.py`.
* [ ] Implement detection logic (Regex/Filename).
* [ ] Implement vulnerability check (SemVer comparison).
* [ ] Register command in `cli.py`.
* [ ] Add tests.
