# Plan: v1.7.0 Integrity Checking

## Objective

Implement SHA256 integrity verification for downloaded extension files.

## Requirements

1. Add a `--verify-hash <sha256>` flag to the `download` command.
2. After download (and before extraction), calculate the SHA256 of the file.
3. Compare with the provided hash.
4. If mismatch:
    * Log error.
    * Delete the downloaded file (security precaution).
    * Raise `IntegrityError`.

## Implementation Details

### 1. Core Logic (`src/fetchext/utils.py` or `src/fetchext/security.py`)

* Add `verify_file_hash(path: Path, expected_hash: str) -> bool`.
* Use `hashlib.sha256`.

### 2. CLI (`src/fetchext/commands/download.py`)

* Add argument `--verify-hash`.
* Call verification logic after `downloader.download()`.

### 3. Exceptions (`src/fetchext/exceptions.py`)

* Add `IntegrityError`.

## Verification

* Unit tests for hash calculation and comparison.
* Integration test: Download with correct hash (pass).
* Integration test: Download with incorrect hash (fail + cleanup).
