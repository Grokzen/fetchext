# Plan: History Tracking

## Goal
Implement a local history tracking system to log all download and extraction operations. This allows users to audit their usage and recall previously downloaded extensions.

## Requirements
1.  **Storage**: Use a JSON file to store history records.
    *   Location: `~/.local/share/fext/history.json` (following XDG Base Directory spec for data).
2.  **Data Structure**:
    ```json
    [
      {
        "id": "aicmkgpgakddgnaphhhpliifpcfhicfo",
        "browser": "chrome",
        "version": "1.2.3",
        "timestamp": "2023-10-27T10:00:00Z",
        "action": "download",
        "status": "success",
        "path": "/path/to/downloaded/file.crx"
      }
    ]
    ```
3.  **CLI Command**: `fext history`
    *   Displays the history in a table (using `rich`).
    *   Options:
        *   `--limit <n>`: Show last N entries (default: 20).
        *   `--clear`: Clear the history.
        *   `--json`: Output as JSON.
4.  **Integration**:
    *   Hook into `download_extension` and `extract_extension` in `core.py` (or via a new `HistoryManager` class).

## Implementation Steps
1.  **Create `src/fetchext/history.py`**:
    *   `HistoryManager` class.
    *   Methods: `add_entry`, `get_entries`, `clear`.
2.  **Update `src/fetchext/core.py`**:
    *   Initialize `HistoryManager`.
    *   Call `add_entry` after successful operations.
3.  **Update `src/fetchext/cli.py`**:
    *   Add `history` subcommand.
4.  **Tests**:
    *   Unit tests for `HistoryManager`.
    *   Integration tests for history persistence.

## Verification
- Run `fext download ...` and check if entry is added.
- Run `fext history` and verify output.
- Run `fext history --clear` and verify file is emptied.
