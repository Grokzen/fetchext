# Plan: Config Validation (v1.5.0 Item 3)

## Goal
Implement schema validation for `config.toml` to ensure that the configuration file contains valid keys and values. This prevents runtime errors caused by typos or invalid types.

## Current State
- `config.py` loads the TOML file into a dictionary.
- No validation is performed on the keys or values.
- Invalid keys are ignored or cause `KeyError` later in the code.

## Proposed Solution
- Define a schema for the configuration.
- Validate the loaded configuration against the schema.
- Raise `ConfigError` if the configuration is invalid.

## Schema Definition
We can use a simple dictionary-based schema or a library like `pydantic` or `voluptuous`. Since we want to keep dependencies minimal, we can implement a simple validator or use `dataclasses` to define the structure.

Given the project's "minimal dependencies" preference, I'll implement a lightweight validation using `dataclasses` or a simple schema dictionary.

### Configuration Structure
```toml
[general]
download_dir = "~/Downloads/extensions"
save_metadata = true
user_agent = "Mozilla/5.0 ..."

[batch]
workers = 4
delay = 1.0

[network]
timeout = 30
retries = 3
proxy = "http://localhost:8080" # Optional
```

## Implementation Steps
1.  **Define Schema**: Create a schema definition in `src/fetchext/config.py`. [x]
2.  **Implement Validator**: Add a `validate_config(config)` function in `src/fetchext/config.py`. [x]
3.  **Integrate**: Call `validate_config` inside `load_config`. [x]
4.  **Test**: Add unit tests for valid and invalid configurations. [x]

## Verification
- Create a test with a valid config. [x]
- Create a test with an invalid config (wrong type, unknown key). [x]
- Verify `ConfigError` is raised with a helpful message. [x]
