# Plan: Image Optimizer (v1.4.0)

## Goal
Implement `fext optimize <file>` to strip metadata from extension images (PNG, JPEG) to save space. This is useful for developers to reduce the size of their extensions before publishing.

## Requirements
1.  **New Command**: `fext optimize <file>`
2.  **Arguments**:
    -   `--output`: Output file path (default: overwrite or `<filename>_optimized.crx`).
    -   `--quality`: JPEG quality (default: 85).
3.  **Functionality**:
    -   Extract the extension (in memory or temp dir).
    -   Iterate over image files (png, jpg, jpeg).
    -   Use `Pillow` (PIL) to optimize images (strip metadata, optimize flag).
    -   Repack the extension (ZIP).
    -   Note: If input is CRX, output will be ZIP because we can't easily re-sign it without the private key.
4.  **Integration**:
    -   Add `optimizer.py`.
    -   Update `cli.py`.
    -   Add `Pillow` to dependencies.

## Implementation Steps
1.  **Add Dependency**:
    -   Add `Pillow` to `pyproject.toml` and `requirements-dev.txt`.
2.  **Create `src/fetchext/optimizer.py`**:
    -   `optimize_extension(file_path: Path, output_path: Path = None)`:
        -   Open source archive.
        -   Create new ZIP archive.
        -   Copy non-image files.
        -   Optimize image files using `Image.save(..., optimize=True, quality=85)`.
3.  **Update `src/fetchext/cli.py`**:
    -   Add `optimize` subcommand.
    -   Call `optimizer.optimize_extension`.
4.  **Tests**:
    -   Unit test with mock images.

## Verification
-   Run `fext optimize ublock-origin.crx -o optimized.zip`.
-   Check size difference.
