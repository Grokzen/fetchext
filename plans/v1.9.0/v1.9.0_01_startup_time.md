# Plan: Optimize Startup Time (v1.9.0)

## Goal

Reduce the CLI startup time by implementing lazy imports for heavy dependencies. The CLI should be snappy, especially for simple commands like `--help` or `config`.

## Heavy Dependencies to Target

- `rich`: Used extensively for output. Can be lazy-loaded in `console.py` or only imported when needed in commands.
- `PIL` (Pillow): Used in `optimizer.py`. Should only be imported when `optimize` command is run.
- `cryptography`: Used in `verifier.py`.
- `lizard`: Used in `analysis/complexity.py`.
- `yara`: Used in `analysis/yara.py`.
- `textual`: Used in `tui.py` and `tutorial.py`.

## Implementation Strategy

1. **Analyze Imports**: Identify where these libraries are imported at the top level.
2. **Lazy Loading**: Move imports inside functions or use type checking guards `if TYPE_CHECKING:` combined with runtime imports.
3. **Console**: `src/fetchext/console.py` initializes `rich.console.Console` globally. This might be hard to make lazy if it's used everywhere. We can try to delay its creation or use a proxy.
4. **Commands**: Ensure that importing `src/fetchext/commands/` modules doesn't trigger heavy imports.
    - Refactor command modules to import heavy logic only within the `run` function.

## Files to Modify

- [x] `src/fetchext/console.py` (Implemented LazyConsole)
- [x] `src/fetchext/optimizer.py` (Lazy import PIL)
- [ ] `src/fetchext/verifier.py` (Check cryptography)
- [x] `src/fetchext/analysis/complexity.py` (Lazy import lizard)
- [x] `src/fetchext/analysis/yara.py` (Lazy import yara)
- [x] `src/fetchext/tui.py` (Already lazy)
- [x] `src/fetchext/tutorial.py` (Lazy import textual)

## Verification

- Measure startup time before and after using `time fext --version`.
- Ensure all commands still work.
