# Plan: v0.7.0 - Permission Risk Scoring

## Goal

Implement `fext risk <file>` to analyze the permissions requested by an extension and assign a "Privacy Risk Score". This helps users understand the potential privacy impact of installing an extension.

## Requirements

1. **CLI Command**: `fext risk <file_path>`
2. **Input**: Path to a `.crx`, `.xpi`, or `.zip` file.
3. **Output**: A report detailing:
    - Risk Score (0-100 or Low/Medium/High/Critical).
    - List of permissions categorized by risk level.
    - Explanation of why certain permissions are risky.

## Implementation Details

### 1. Core Logic (`src/fetchext/risk.py`)

- Class `RiskAnalyzer`.
- Method `analyze(file_path) -> RiskReport`.
- **Risk Database**: A dictionary mapping permissions to risk levels/scores.
  - **Critical (10)**: `<all_urls>`, `*://*/*`, `webRequestBlocking`, `cookies`, `debugger`, `proxy`.
  - **High (7)**: `tabs`, `history`, `bookmarks`, `management`, `privacy`.
  - **Medium (4)**: `storage`, `unlimitedStorage`, `notifications`, `contextMenus`.
  - **Low (1)**: `alarms`, `idle`, `power`.
- **Scoring Algorithm**:
  - Sum of weights of all permissions.
  - Normalize or categorize (e.g., Score > 20 = Critical).
  - Or just return the raw score and the max risk level found.

### 2. CLI (`src/fetchext/cli.py`)

- Add `risk` subcommand.
- Arguments: `file`, `--json`.
- Output: Use `rich` to display a gauge or colored score.

## Testing Strategy

1. **Unit Tests**:
    - Test `RiskAnalyzer` with manifests containing various permission combinations.
    - Verify score calculation.
2. **Integration Tests**:
    - Run against dummy extensions.

## Tasks

- [ ] Create `src/fetchext/risk.py`.
- [ ] Implement `RiskAnalyzer` and permission weights.
- [ ] Add `risk` command to `src/fetchext/cli.py`.
- [ ] Add `analyze_risk` to `src/fetchext/core.py`.
- [ ] Add tests.
