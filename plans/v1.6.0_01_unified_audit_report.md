# Plan: Unified Audit Report (v1.6.0 Item 1)

## Goal

Create a single, comprehensive JSON report format that combines results from various analysis tools (Risk, Secrets, MV3 Audit, Complexity, Entropy, Domains). This allows for easier consumption by CI/CD pipelines and external tools.

## Current State

- `fext audit` returns MV3 audit.
- `fext risk` returns permission risk.
- `fext analyze` has multiple flags (`--complexity`, `--entropy`, etc.) returning separate structures.
- `fext report` generates Markdown.

## Proposed Solution

- Create a new command `fext full-audit <file>` (or enhance `report` with `--json`).
- Define a unified JSON schema.
- The report should contain:
  - Metadata (Name, Version, ID, Hash)
  - MV3 Compatibility
  - Permission Risk
  - Secrets Found
  - Complexity Metrics
  - Entropy Metrics
  - Domain/URL Analysis
  - YARA Matches (if rules provided)

## Schema Structure

```json
{
  "metadata": { ... },
  "mv3_audit": { ... },
  "risk_analysis": { ... },
  "secrets": [ ... ],
  "complexity": { ... },
  "entropy": { ... },
  "domains": [ ... ],
  "urls": [ ... ],
  "yara_matches": { ... }
}
```

## Implementation Steps

1. [x] **Create Schema**: Define the structure in `src/fetchext/schemas.py` (or similar). (Implicitly defined in `core.py`)
2. [x] **Implement Aggregator**: Create a function `generate_unified_report(file_path)` in `src/fetchext/core.py` that calls all individual analyzers.
3. [x] **CLI Command**: Add `fext full-audit` or `fext report --json`. Let's go with `fext report --json` as it aligns with existing reporting.
4. [x] **Test**: Verify the output format.

## Verification

- Run `fext report <file> --json` and validate the output against the schema.
