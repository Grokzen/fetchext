# Plan: Secret Scanner (v1.3.0)

## Goal

Implement a Secret Scanner to detect potential API keys, tokens, and private keys within extension source code.

## Requirements

1. **Command**: `fext analyze --secrets <file>`
2. **Analysis**:
    * Scan all text-based files (JS, HTML, JSON, CSS, etc.) in the extension.
    * Use regex patterns to identify potential secrets:
        * AWS Keys (AKIA...)
        * Google API Keys (AIza...)
        * Private Keys (BEGIN RSA PRIVATE KEY...)
        * Generic Tokens (Bearer ...)
        * Slack Tokens (xox[baprs]-...)
        * Stripe Keys (sk_live_...)
    * Report file path, line number, and type of secret found.
    * **Security**: Do NOT print the full secret in the output (mask it).
3. **Output**:
    * Console output with findings.
    * Integration with `fext report` (optional but good).

## Implementation Steps

### 1. Core Logic (`src/fetchext/scanner.py` or `src/fetchext/secrets.py`)

* Create `src/fetchext/secrets.py` (or add to `scanner.py` if appropriate).
* Define a `SecretScanner` class.
* Define a list of regex patterns for common secrets.
* Implement `scan_file(content: str) -> List[SecretFinding]`.
* Implement `scan_extension(file_path: Path) -> List[SecretFinding]`.

### 2. CLI Integration (`src/fetchext/cli.py`)

* Add `--secrets` flag to `analyze` command parser.
* Call `SecretScanner.scan_extension` when flag is present.
* Print results using `rich` table.

### 3. Testing

* Create `tests/unit/test_secrets.py`.
* Test cases:
  * File with AWS key.
  * File with Google API key.
  * File with no secrets.
  * Binary file (should be skipped or handled gracefully).

## Verification

* Create a dummy extension with a fake API key.
* Run `fext analyze --secrets dummy.crx`.
* Verify the key is detected and masked in the output.
