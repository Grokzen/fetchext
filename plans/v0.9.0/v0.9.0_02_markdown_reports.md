# Plan: Markdown Reports (v0.9.0)

## Goal

Implement a `fext report <file>` command that generates a comprehensive Markdown report for a given extension file (CRX, XPI, or ZIP). The report should include metadata, permission risk analysis, and file structure summary.

## Requirements

1. **CLI Command**: `fext report <file_path> [-o/--output <output_file>]`
    * If `--output` is not specified, default to `REPORT.md` in the current directory (or alongside the input file? Let's say current directory or derived from filename e.g. `<filename>_REPORT.md`).
    * Let's stick to: Default to `<extension_id>_REPORT.md` or just print to stdout if requested? The roadmap says "generate a readable REPORT.md". Let's default to `REPORT.md` if single file, or `<id>.md` if we want to be specific.
    * Let's decide: `fext report <file>` -> generates `<file_basename>_report.md` by default.

2. **Content**:
    * **Header**: Extension Name, Version, ID, Author (if available).
    * **Metadata**: Description, Homepage, Update URL, Size, Hashes (SHA256).
    * **Risk Analysis**:
        * Privacy Risk Score.
        * List of Permissions with descriptions (using `risk.py` logic).
        * List of Host Permissions.
    * **Manifest Dump**: A collapsible section with the full JSON manifest.
    * **File Structure**: A summary of the file tree (top-level folders/files).

3. **Implementation Details**:
    * Reuse `fetchext.core` functions (`inspect_extension`, `scan_extension` logic).
    * Reuse `fetchext.risk` for scoring.
    * New module `fetchext.report` or add to `fetchext.auditor`? `auditor.py` seems like a good place, or a new `reporter.py`. Let's create `src/fetchext/reporter.py` to keep it clean.

## Architecture

* **`src/fetchext/reporter.py`**:
  * `class MarkdownReporter`:
    * `generate_report(file_path: Path) -> str`: Generates the Markdown string.
    * `save_report(content: str, output_path: Path)`: Writes to file.
* **`src/fetchext/cli.py`**:
  * Add `report` subcommand.

## Testing Strategy

* **Unit**: Test `MarkdownReporter.generate_report` with mocked extension data.
* **Integration**: Run `fext report` on a dummy CRX and verify output file existence and content.

## Steps

1. Create `src/fetchext/reporter.py`.
2. Implement `generate_report` logic using `rich` for formatting (if printing) or just string manipulation for file generation. Since it's a file, standard f-strings/textwrap is fine.
3. Integrate into `cli.py`.
4. Add tests in `tests/unit/test_reporter.py` and `tests/cli/test_report.py`.
5. Update docs.
