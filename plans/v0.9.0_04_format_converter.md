# Plan: Format Converter (v0.9.0)

## Goal

Implement a `fext convert` command that allows converting between different extension formats:

* CRX -> ZIP
* ZIP -> CRX (requires signing, maybe just unsigned ZIP for now? Or just repackaging?)
* Source Directory -> ZIP
* Source Directory -> CRX (requires signing)

Given the complexity of signing (needs private key), we will focus on:

1. **CRX -> ZIP**: Extract and re-zip (stripping CRX header).
2. **ZIP -> Source**: Extract (already covered by `extract` command, but `convert` implies changing format).
3. **Source -> ZIP**: Pack directory into ZIP.
4. **CRX -> Source**: Extract (same as `extract`).

So `convert` is mostly about packing/unpacking and changing containers.
Let's define `convert <input> <output_format>` or `convert <input> -t <format>`.

Supported conversions:

* `crx` -> `zip` (Strip header)
* `dir` -> `zip` (Pack)
* `zip` -> `dir` (Unpack - alias to extract)

We won't support creating CRX files yet as that requires key management which is a bigger scope (v1.0.0 Signed Releases).

## Requirements

1. **CLI Command**: `fext convert <input_file_or_dir> --to <format> [-o <output>]`
    * `--to`: `zip`, `dir` (maybe `crx` later).
    * If input is CRX and target is ZIP: Extract payload.
    * If input is Dir and target is ZIP: Zip it.

2. **Implementation Details**:
    * **CRX to ZIP**: Read CRX header, find ZIP offset, copy remaining bytes to new file. This is efficient and doesn't require re-compression.
    * **Dir to ZIP**: Use `zipfile` to archive a directory.

## Architecture

* **`src/fetchext/converter.py`**:
  * `convert_to_zip(input_path: Path, output_path: Path)`
* **`src/fetchext/cli.py`**:
  * Add `convert` subcommand.

## Testing Strategy

* **Unit**: Test `convert_to_zip` with CRX input (mocked header) and Dir input.
* **Integration**: Convert a real dummy CRX to ZIP and verify it opens.

## Steps

1. Create `src/fetchext/converter.py`.
2. Implement `crx_to_zip` and `dir_to_zip`.
3. Integrate into `cli.py`.
4. Add tests.
5. Update docs.
