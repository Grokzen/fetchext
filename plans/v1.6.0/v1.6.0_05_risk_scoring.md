# Plan: Risk Scoring Tuning

## Goal

Refine the risk scoring algorithm in `src/fetchext/risk.py` to account for dangerous combinations of permissions, rather than just summing individual scores.

## Current State

- `src/fetchext/risk.py`: Likely assigns a score to each permission and sums them up, or takes the max.
- `src/fetchext/analysis/risk.py`: (Check if this exists or if it's just `risk.py`).

## Proposed Changes

### 1. Analyze Current Logic

- Read `src/fetchext/risk.py`.
- Identify how the score is currently calculated.

### 2. Implement Combination Logic

- Define a list of "Toxic Combinations".
  - Example: `tabs` + `cookies` + `*://*/*` (Full access to browsing data).
  - Example: `webRequest` + `webRequestBlocking` + `*://*/*` (Man-in-the-middle potential).
  - Example: `clipboardWrite` + `clipboardRead` (Full clipboard access).
- If a combination is present, add a "Synergy Bonus" to the risk score or trigger a specific warning.

### 3. Refine Individual Scores

- Review existing scores in `PERMISSION_RISK_SCORES` (or similar constant).
- Adjust based on modern manifest V3 understanding (e.g., `scripting` vs `tabs.executeScript`).

### 4. Testing

- Create a test case with a manifest containing these combinations.
- Verify the score is higher than the sum of parts.

## Implementation Steps

1. **Explore**: Read `src/fetchext/risk.py`.
2. **Design**: Define the combinations and their penalty scores.
3. **Refactor**: Update `analyze_risk` (or equivalent) to check for combinations.
4. **Verify**: Add unit test.

## Verification

- Run `pytest tests/unit/test_risk.py`.
