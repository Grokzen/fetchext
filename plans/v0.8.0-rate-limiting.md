# Plan: Rate Limiting (v0.8.0)

## Goal

Implement configurable rate limiting to prevent IP bans during bulk operations.

## Design

- **Module**: `src/fetchext/network.py`
- **Configuration**: `rate_limit_delay` in config (seconds).
- **Mechanism**:
  - Create a `RateLimitedSession` class inheriting from `requests.Session`.
  - Override `request` method to sleep before making a request.
  - Use a global lock if we want to support multi-threading (which we do for batch downloads).
- **Integration**:
  - Update `get_session` to return `RateLimitedSession` if rate limiting is enabled.
  - Update `src/fetchext/config.py` to read `rate_limit_delay`.

## Implementation Steps

1. Update `src/fetchext/config.py` to expose `rate_limit_delay`.
2. Update `src/fetchext/network.py`.
   - Import `time` and `threading`.
   - Define `RateLimitedSession`.
   - Update `get_session` to use it.
3. Add tests.
   - `tests/unit/test_network.py`.

## RateLimitedSession

```python
class RateLimitedSession(requests.Session):
    def __init__(self, delay=0.0):
        super().__init__()
        self.delay = delay
        self._lock = threading.Lock()
        self._last_request_time = 0

    def request(self, method, url, *args, **kwargs):
        with self._lock:
            elapsed = time.time() - self._last_request_time
            if elapsed < self.delay:
                time.sleep(self.delay - elapsed)
            self._last_request_time = time.time()
        return super().request(method, url, *args, **kwargs)
```
