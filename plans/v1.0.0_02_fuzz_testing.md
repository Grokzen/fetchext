# Plan: Fuzz Testing (v1.0.0)

## Goal

Implement fuzz testing to verify the robustness of the `CrxDecoder` and `PartialFileReader` against malformed or malicious inputs.

## Tools

- **Hypothesis**: Property-based testing library for Python. It's easier to integrate into the existing `pytest` suite than binary fuzzers like `atheris` or `libfuzzer`, and effective for structured data like CRX headers.

## Strategy

### 1. Target: `src/fetchext/crx.py`

- The `CrxDecoder` class parses binary headers.
- We need to fuzz:
  - `magic` (should be `Cr24`)
  - `version` (should be 3)
  - `header_length` (4 bytes)
  - `header_data` (Protobuf content)

### 2. Target: `src/fetchext/protobuf.py`

- The custom Protobuf parser.
- We need to fuzz the `decode` method with random byte strings to ensure it doesn't crash (e.g., `IndexError`, `RecursionError`).

### 3. Implementation

- Create `tests/fuzz/` directory.
- Create `tests/fuzz/test_crx_fuzz.py`.
- Use `hypothesis.strategies` to generate random byte streams.
- Define properties:
  - "Parsing should never raise an unhandled exception (crash)."
  - "If parsing succeeds, the output structure must be valid."

### 4. Integration

- Add `hypothesis` to `requirements-dev.txt`.
- Add `make fuzz` target (or just run as part of `make test` but maybe with a specific marker if it's slow).

## Steps

1. Add `hypothesis` to `requirements-dev.txt`.
2. Create `tests/fuzz/test_protobuf_fuzz.py` to fuzz the custom protobuf decoder.
3. Create `tests/fuzz/test_crx_fuzz.py` to fuzz the CRX decoder.
4. Run tests and fix any crashes found.
5. Update `Makefile`.
