# Plan: YARA Integration Enhancement

## Goal

Enhance the `fext analyze --yara` command to accept a directory of YARA rule files (`.yar` or `.yara`) in addition to a single file. This allows users to use a collection of rules for scanning.

## Current State

- `src/fetchext/analysis/yara.py`: `analyze_yara` function likely takes a single file path for rules.
- `src/fetchext/cli.py`: Argument parser expects a single file.

## Proposed Changes

### 1. Update `src/fetchext/analysis/yara.py`

- Modify `analyze_yara` to handle `rules_path` as either a file or a directory.
- If it's a directory:
  - Iterate through all files ending in `.yar` or `.yara`.
  - Compile all valid rule files.
  - Ideally, compile them into a single `yara.Rules` object if possible, or iterate through compiled rules.
  - *Note*: `yara.compile` can take `filepaths` (a dict mapping namespace to path). This is efficient.

### 2. Update `src/fetchext/cli.py`

- Update help text for `--yara` argument to indicate it accepts a file or directory.
- Ensure validation logic (if any) supports directories.

### 3. Testing

- Create a test case with a directory containing multiple dummy YARA rule files.
- Verify that rules from all files are applied.

## Implementation Steps

1. **Explore**: Check current implementation of `analyze_yara`.
2. **Refactor**: Update `analyze_yara` to use `yara.compile(filepaths=...)` when a directory is provided.
3. **CLI**: Update help text.
4. **Verify**: Add unit test.

## Verification

- Run `pytest tests/unit/test_yara.py` (create if missing or update).
