# Plan: Refactor Utils Module

## 1. Introduction

The `src/fetchext/utils.py` module has grown significantly and contains a mix of file system operations, string manipulation, hashing, and other utility functions. This makes it hard to maintain and test. This task involves splitting it into smaller, focused modules.

## 2. Objectives

- Decompose `utils.py` into granular modules within a `src/fetchext/utils/` package.
- Maintain backward compatibility where possible or update all call sites.
- Improve testability of individual utility functions.

## 3. Implementation Details

### 3.1. New Package Structure

Create `src/fetchext/utils/` and move logic into:

- `fs.py`: File system operations (ensure_dir, safe_filename, etc.).
- `hashing.py`: Hashing functions (sha256_file, etc.).
- `string.py`: String manipulation (slugify, etc.).
- `network.py`: Network helpers (if any remain outside `NetworkClient`).
- `time.py`: Time/Date helpers.
- `__init__.py`: Re-export common functions to minimize breakage, or decide to fully deprecate `fetchext.utils` as a module and use it as a package.

### 3.2. Refactoring Steps

1. **Create Package**: Create `src/fetchext/utils/` directory.
2. **Migrate Code**: Move functions from `src/fetchext/utils.py` to their new homes.
3. **Update Imports**: Search and replace imports across the codebase.
    - From: `from fetchext.utils import foo`
    - To: `from fetchext.utils.fs import foo` (or keep `fetchext.utils` re-exports).
4. **Deprecation**: If keeping `src/fetchext/utils.py` for compatibility, add deprecation warnings. Ideally, fully refactor to the new structure.

### 3.3. Testing

- Verify all existing unit tests pass.
- Add specific tests for the new modules if coverage was low.

## 4. Verification

- Run `make test` to ensure no regressions.
- Run `make lint` to check for circular imports or unused imports.
