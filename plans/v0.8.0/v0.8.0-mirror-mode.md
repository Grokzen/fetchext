# Plan: Mirror Mode (v0.8.0)

## Goal

Implement a `mirror` command to synchronize a local directory with a list of extensions defined in a file. This ensures the local repository matches the desired state (downloading new/updated extensions, optionally removing unlisted ones).

## Requirements

1. **Command**: `fext mirror <list_file> [--output-dir <dir>] [--prune] [--workers <n>]`
    * `list_file`: Path to a file containing extension IDs/URLs (same format as batch file).
    * `--output-dir`: Target directory (default: current dir).
    * `--prune`: Remove files in the output directory that are not in the list.
    * `--workers`: Number of parallel downloads.
2. **Logic**:
    * Parse the list file to get desired extensions (Browser, ID/URL).
    * Scan the output directory for existing extensions.
    * **Sync Loop**:
        * For each desired extension:
            * Determine ID.
            * Check if file exists locally (e.g., `<id>.crx` or `<slug>.crx`).
            * If exists: Check for updates (compare local version vs remote).
            * If update available or missing: Download.
    * **Prune Loop** (if `--prune`):
        * Identify files in output dir that do not correspond to any ID in the list.
        * Delete them.

## Implementation Details

### 1. New Module: `src/fetchext/mirror.py`

* Class `MirrorManager`
  * `sync(list_path, output_dir, prune=False, workers=4)`
  * `_process_item(item)`: Helper for thread pool.

### 2. CLI Integration

* Add `mirror` subcommand.

### 3. Reuse Existing Logic

* `BatchProcessor` parses the file. We can reuse or extend it.
* `check_update` logic from `core.py` is useful but might need adaptation for "check remote version without downloading first" if we want to be efficient.
* Currently `check_update` takes a *local file*. We need to check *remote* version given an ID.
* `BaseDownloader.get_latest_version(id)` exists.

## Testing Strategy

1. **Unit**: Test sync logic with mocked downloader and file system.
2. **Integration**: Run against a temp dir with a fake list.

## Tasks

* [ ] Create `src/fetchext/mirror.py`.
* [ ] Implement `MirrorManager`.
* [ ] Register command in `cli.py`.
* [ ] Add tests.
