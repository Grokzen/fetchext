# Plan: Cache Management (v1.2.0)

## Goal

Implement a `clean` command to manage disk usage by removing temporary files, download caches, and build artifacts.

## Requirements

1. **Command**: `fext clean`
2. **Targets**:
    * `--cache`: Clear internal caches (e.g., `__pycache__`, `.pytest_cache`, `build/`, `dist/`, `.egg-info`).
    * `--downloads`: Clear the default download directory (optional, requires confirmation).
    * `--logs`: Clear log files if any.
    * `--all`: Clear everything safe to delete.
3. **Safety**:
    * Ask for confirmation before deleting non-trivial data (like downloads).
    * Add `--force` / `-f` flag to skip confirmation.
4. **Output**: Report what was deleted and how much space was reclaimed.

## Implementation Steps

### 1. Core Logic (`src/fetchext/core.py` or `src/fetchext/clean.py`)

* Create `src/fetchext/clean.py`.
* Function `clean_artifacts(targets: List[str], force: bool = False)`.
* Logic to identify paths to clean:
  * `build/`, `dist/`, `*.egg-info` (Build artifacts)
  * `__pycache__` (recursively)
  * `.pytest_cache`, `.mypy_cache`, `.ruff_cache` (Test/Lint caches)
* Logic to calculate size before deletion.
* Use `shutil.rmtree` for directories and `os.remove` for files.

### 2. CLI Integration (`src/fetchext/cli.py`)

* Add `clean` subcommand.
* Arguments:
  * `--cache`: Clean build/test caches (default if no args?).
  * `--downloads`: Clean download directory (from config).
  * `--all`: Clean both.
  * `--force`: Skip confirmation.
  * `--dry-run`: Show what would be deleted.

### 3. Testing

* Create `tests/unit/test_clean.py`.
* Use `pyfakefs` to create dummy cache directories and files.
* Verify that `clean` removes them.
* Verify that `clean --downloads` removes downloads.
* Verify that `clean --dry-run` does not remove anything.

## Verification

* Create some dummy build artifacts (`mkdir build`, `touch build/test`).
* Run `fext clean --dry-run` -> should list `build/`.
* Run `fext clean` -> should remove `build/`.
