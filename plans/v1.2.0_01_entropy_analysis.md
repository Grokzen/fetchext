# Plan: Entropy Analysis (v1.2.0)

## Goal

Implement entropy analysis to detect high-entropy strings or files within an extension, which often indicates obfuscation, packed code, or encrypted data (secrets).

## Strategy

1. **Entropy Calculation**: Implement Shannon entropy calculation for files and strings.
2. **File Scanning**: Iterate through all files in the extension (CRX/ZIP).
3. **Thresholding**: Define thresholds for "high entropy" (e.g., > 7.5 for files, > 5.0 for strings).
4. **Reporting**: Output files with high entropy and specific high-entropy strings found in text files.

## Implementation Details

### 1. Core Logic (`src/fetchext/analysis/entropy.py`)

- `calculate_entropy(data: bytes) -> float`: Returns Shannon entropy (0-8).
- `analyze_entropy(file_path: Path) -> Dict`:
  - Iterate through files in the ZIP.
  - Calculate entropy for each file.
  - If file is text (JS, HTML, CSS), scan for high-entropy string literals (optional, might be too slow/noisy for v1).
  - Focus on file-level entropy first.

### 2. CLI Integration (`src/fetchext/cli.py`)

- Update `analyze` command to accept `--entropy` flag.
- Output results in a table (File Path, Entropy Score, Verdict).

### 3. Testing

- Unit tests for entropy calculation.
- Integration test with a dummy extension containing random data.

## Verification

- Run `fext analyze --entropy <file>` on a known extension.
- Verify high entropy for images/compressed files (expected) and check for unexpected high entropy in JS files.
